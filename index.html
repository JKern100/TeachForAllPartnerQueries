<!doctype html>
<html lang="en" class="h-full">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Partner Insights 1.0</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <meta name="color-scheme" content="light" />
  <style>
    :root{
      /* Teach For All–inspired palette (override these with official hexes when you have them) */
      --tfa-primary:  #8B1E3F;  /* deep burgundy */
      --tfa-secondary:#007C89;  /* teal */
      --tfa-accent:   #F26B5B;  /* coral */
      --tfa-bg:       #ffffff;  /* page background */
      --tfa-surface:  #f7f7f8;  /* cards */
      --tfa-border:   #e5e7eb;  /* borders */
      --tfa-text:     #0f172a;  /* slate-900 */
      --tfa-muted:    #475569;  /* slate-600 */
    }
    .bg-grid {
      background-image: linear-gradient(to right, rgba(16,24,40,.04) 1px, transparent 1px),
                        linear-gradient(to bottom, rgba(16,24,40,.04) 1px, transparent 1px);
      background-size: 24px 24px;
    }
  </style>
</head>
<body class="h-full bg-[var(--tfa-bg)] text-[var(--tfa-text)] bg-grid">
  <div class="mx-auto max-w-6xl p-6">
    <header class="mb-8 flex items-center justify-between">
      <div>
        <h1 class="text-3xl font-semibold tracking-tight">Partner Insights 1.0</h1>
        <p class="text-sm text-[var(--tfa-muted)] mt-1">Filter Supabase → Ask Gemini → See answers with sources.</p>
      </div>
      <span class="hidden sm:inline-flex items-center rounded-full border border-[var(--tfa-border)] px-3 py-1 text-xs text-[var(--tfa-muted)]">v1.0</span>
    </header>

    <div class="grid lg:grid-cols-2 gap-6">
      <section class="rounded-2xl border border-[var(--tfa-border)] bg-[var(--tfa-surface)] shadow-sm">
        <div class="p-6">
          <h2 class="text-lg font-medium">Query Builder</h2>
          <p class="text-sm text-[var(--tfa-muted)] mb-4">Enter filters and an optional custom prompt. We’ll POST to your Zapier hook.</p>

          <form id="queryForm" class="space-y-5">
            <div>
              <label for="countries" class="block text-sm font-medium">Countries</label>
              <div class="mt-1 flex items-center gap-2">
                <input id="countries" type="text" inputmode="text" placeholder="Albania, Latvia"
                       class="w-full rounded-xl border border-[var(--tfa-border)] bg-white px-3 py-2 text-sm placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-[var(--tfa-primary)]/30" />
                <button type="button" id="pickCountries" class="rounded-xl border border-[var(--tfa-border)] px-3 py-2 text-xs text-[var(--tfa-text)] hover:bg-white">Pick</button>
              </div>
              <p class="text-xs text-[var(--tfa-muted)] mt-1">Comma-separated. Click <span class="font-medium">Pick</span> to select from a list.</p>
              <div id="countryChips" class="mt-2 flex flex-wrap gap-2"></div>
            </div>

            <div class="grid grid-cols-2 gap-3">
              <div>
                <label for="from" class="block text-sm font-medium">From</label>
                <input id="from" type="date" class="mt-1 w-full rounded-xl border border-[var(--tfa-border)] bg-white px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-[var(--tfa-primary)]/30" />
              </div>
              <div>
                <label for="to" class="block text-sm font-medium">To</label>
                <input id="to" type="date" class="mt-1 w-full rounded-xl border border-[var(--tfa-border)] bg-white px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-[var(--tfa-primary)]/30" />
              </div>
            </div>

            <div>
              <label for="topic" class="block text-sm font-medium">Topic (keyword)</label>
              <input id="topic" type="text" placeholder="funding, TACL, grant" class="mt-1 w-full rounded-xl border border-[var(--tfa-border)] bg-white px-3 py-2 text-sm placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-[var(--tfa-primary)]/30" />
            </div>

            <div>
              <label for="prompt" class="block text sm font-medium">Custom prompt (optional)</label>
              <textarea id="prompt" rows="4" placeholder="Write a brief update for leadership..." class="mt-1 w-full rounded-xl border border-[var(--tfa-border)] bg-white px-3 py-2 text-sm placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-[var(--tfa-primary)]/30"></textarea>
            </div>

            <div>
              <label for="hook" class="block text-sm font-medium">Zapier Catch Hook URL</label>
              <input
                id="hook"
                type="url"
                placeholder="https://hooks.zapier.com/hooks/catch/4724942/u6idoag/"
                value="https://hooks.zapier.com/hooks/catch/4724942/u6idoag/"
                class="mt-1 w-full rounded-xl border border-[var(--tfa-border)] bg-white px-3 py-2 text-sm placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-[var(--tfa-primary)]/30"
              />
              <p class="text-xs text-[var(--tfa-muted)] mt-1">Your Zap will validate, query Supabase, ask Gemini, and respond.</p>
            </div>

            <div class="flex items-center gap-3 pt-2">
              <button id="run" type="submit" class="inline-flex items-center gap-2 rounded-xl bg-[var(--tfa-primary)] px-4 py-2 text-sm font-medium text-white shadow hover:brightness-110 focus:outline-none focus:ring-2 focus:ring-[var(--tfa-primary)]/40">
                <svg id="runSpinner" class="hidden h-4 w-4 animate-spin" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"></path></svg>
                <span>Run</span>
              </button>
              <button type="button" id="resetBtn" class="rounded-xl border border-[var(--tfa-border)] px-4 py-2 text-sm hover:bg-white">Reset</button>
            </div>
          </form>
        </div>
      </section>

      <section class="rounded-2xl border border-[var(--tfa-border)] bg-[var(--tfa-surface)] shadow-sm">
        <div class="p-6">
          <h2 class="text-lg font-medium mb-3">Answer</h2>
          <div id="answer" class="min-h-[140px] whitespace-pre-wrap rounded-xl border border-[var(--tfa-border)] bg-white p-4"></div>

          <h3 class="text-sm font-medium mt-6 mb-2">Sources</h3>
          <div class="overflow-auto rounded-xl border border-[var(--tfa-border)] bg-white">
            <table class="min-w-full text-sm">
              <thead class="bg-[color-mix(in srgb,var(--tfa-primary),white 90%)] text-[var(--tfa-text)]/90">
                <tr>
                  <th class="px-3 py-2 text-left">Date</th>
                  <th class="px-3 py-2 text-left">Countries</th>
                  <th class="px-3 py-2 text-left">Headline</th>
                </tr>
              </thead>
              <tbody id="sources" class="divide-y divide-[var(--tfa-border)]
